### 定义一个pod

一个pod存在多个容器，公用一个ip地址。

#### 如何生成一个pod的yaml

##### 1）--dry-run方式

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161302578.png)

把yaml输入文件中

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161303797.png)

##### 2）官网拷贝

这里不多做介绍

#### 如何编写一个pod的yaml文件

##### 1）查看资源对象-版本--pod版本

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161307617.png)

##### 2）yaml文件定义pod的版本

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161306224.png)

##### 3）查看如何定义资源类型

**查看pod资源对象的定义方法**

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161335425.png)

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161311763.png)

**查看pod.spec定义方法**

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161325754.png)



##### 4）定义kind、metadatas等资源类型

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161316664.png)

#### 修改容器的启动命令（使用cmd、ags）

##### 1)使用cmd覆盖entrypoint

创建pod容器沉睡10秒

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161459406.png)

cmd将默认的启动命令覆盖使得容器沉睡10秒

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161329515.png)

##### 2）使用ags覆盖cmd

这里不展开演示

#### pod的状态及问题排查方法

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161336017.png)

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161336523.png)

pod处于running状态，redy数值相等且restarts的数据不再增加，可判定pod为可用

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161341151.png)

当配置为nerver restart时，pod可用时status显示为succecced

node节点挂掉status显示为unkown

#### pod的镜像拉取策略（pod中容器的镜像拉取）

##### 1)always

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161352262.png)

##### 2)nerver

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161352215.png)

#####  3)IfNotpresent

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161353077.png)

 

####  pod重启策略（pod中容器的重启策略）

##### 1）always

always中容器失效的情况指的是可能网络原因、配置有误等等原因导致的容器失效。

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161411555.png)

##### 2）onfailure

适用于job定时计划任务

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161412642.png)

##### 3）never

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161412266.png)

#### 探针的四种探测方法

startupprobe优先进行探测，探测失败了再进行livenessprobe和readinessProbe的探测。正常情况下，容器比较重要时，那么一个pod中有多个容器那么每个容器都需要配置一个健康检查。

##### 1）startupprobe（仅探测一次）

适合于启动比较慢的容器。

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161421402.png)

##### 2）livenessprobe存活探针（循环探测）

功能与startupprobe类似，唯一的区别是存活探针属于循环探测。适合于启动比较快的容器。属于生产中常见且重要的配置

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161421219.png)

##### 3) readinessProbe就绪探针（循环探测）

属于生产中常见且重要的配置

![](https://raw.githubusercontent.com/zoowemama1930/DMimagest1/main/202409161421457.png)

#### 零宕机服务发布liveness和readines